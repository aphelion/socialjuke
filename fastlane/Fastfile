fastlane_version "1.96.0"

default_platform :android

desc 'Run React Native tests'
lane :react_native_test do
  sh 'cd ../ares && npm test'
end

platform :android do
  desc 'Download Android dependencies'
  lane :dependencies do
    gradle(
      project_dir: './ares/android',
      task: 'preBuild'
    )
  end

  desc 'Run Android tests'
  lane :test do
    gradle(
      project_dir: './ares/android',
      task: 'test'
    )
  end

  desc 'Push an Android build to staging'
  lane :staging do
    gradle(
      project_dir: './ares/android',
      task: 'printVersion assembleRelease'
    )
    supply(
      package_name: 'io.aphelion.ares',
      track: 'alpha',
      apk: './ares/android/app/build/outputs/apk/app-release.apk',
      json_key: './ares/android/secrets/ares-play-credentials.json'
    )
  end 
end
