dependencies:
  pre:
    # https://discuss.circleci.com/t/bundler-fails-to-find-appropriate-version-despite-installing-appropriate-version-earlier-in-the-build/2815/33
    - rvm install rubygems 2.4.8 --force
    - gem install bundler -v 1.12.5

    - cd ares && npm install
    - bundle install
    - echo y | android update sdk --no-ui --all --filter "tools,platform-tools,android-23"
    - echo y | android update sdk --no-ui --all --filter "build-tools-23.0.3"
    - fastlane android dependencies
test:
  override:
    - fastlane react_native_test
    - fastlane android test
  post:
    - cp -r ares/app/build/test-results/* $CIRCLE_TEST_REPORTS
deployment:
  staging:
    branch: master
    commands:
      - ./ares/ci/decode-secrets.sh
      - fastlane android staging
notify:
  webhooks:
    - url: http://mcc.aphelion.io/builds/3/hook/circle
